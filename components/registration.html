<li id="registration" class="l-section section">
  <div class="registration">
    <h2>Registration</h2>
    <div class="container-registration">
      <form id="form" method="POST" class="registration-request">
        <div class="">
          <div class="row">
            <div>
              <label for="firstName">First Name:</label><br>
              <input type="text" id="firstName" name="FirstName" required>
            </div>
            <div>
              <label for="lastName">Last Name:</label><br>
              <input type="text" id="lastName" name="LastName" required>
            </div>
          </div>
          <div class="input">
            <label for="email">Email:</label><br>
            <input type="email" id="email" name="Email" required>
          </div>

          <div class="input">
            <label for="university">University:</label><br>
            <input type="text" id="university" name="University" required>
          </div>

          <div class="input">
            <label for="ieeeMember">Are you an IEEE Member?</label><br>
            <select id="ieeeMember" name="IEEE Member" required>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </div>

          <div class="input">
            <label for="expectations">What do you expect from the event?</label><br>
            <textarea id="expectations" name="Expectations" rows="4" required></textarea>
          </div>
          <button type="submit" id="submit-button">Register</button>
        </div>
      </form>
      <div
        id="message"
        style="
          display: none;
          margin: 20px;
          font-weight: bold;
          color: green;
          padding: 8px;
          background-color: beige;
          border-radius: 4px;
          border-color: aquamarine;
        "
      ></div>
    </div>
  </div>
  <script>
   document.getElementById("form").addEventListener("submit", async function (e) {
  e.preventDefault(); 
  document.getElementById("message").textContent = "Submitting..";
  document.getElementById("message").style.display = "block";
  document.getElementById("submit-button").disabled = true;

  const email = document.getElementById("email").value;

  const existingEmails = await fetchEmails();

  if (existingEmails.includes(email)) {
    document.getElementById("message").textContent =
      "This email is already registered. Please use a different email.";
    document.getElementById("message").style.display = "block";
    document.getElementById("message").style.backgroundColor = "red";
    document.getElementById("message").style.color = "white";
    document.getElementById("submit-button").disabled = false;
    return;
  }
  var formData = new FormData(this);
  var keyValuePairs = [];
  for (var pair of formData.entries()) {
    keyValuePairs.push(pair[0] + "=" + pair[1]);
  }

  var formDataString = keyValuePairs.join("&");

  fetch(
    "https://script.google.com/macros/s/AKfycbyGGp5ipXB19leYeKddnHwDOUf0VCQ2Sj8iOjpU0DvLkzcxIows39cvnp7Puqi9cHY/exec",
    {
      redirect: "follow",
      method: "POST",
      body: formDataString,
      headers: {
        "Content-Type": "text/plain;charset=utf-8",
      },
    }
  )
    .then(function (response) {
      if (response) {
        return response; 
      } else {
        throw new Error("Failed to submit the form.");
      }
    })
    .then(function (data) {
      document.getElementById("message").textContent =
        "Data submitted successfully!";
      document.getElementById("message").style.display = "block";
      document.getElementById("message").style.backgroundColor = "green";
      document.getElementById("message").style.color = "beige";
      document.getElementById("submit-button").disabled = false;
      document.getElementById("form").reset();

      setTimeout(function () {
        document.getElementById("message").textContent = "";
        document.getElementById("message").style.display = "none";
      }, 2600);
    })
    .catch(function (error) {
      console.error(error);
      document.getElementById("message").textContent =
        "An error occurred while submitting the form.";
      document.getElementById("message").style.display = "block";
    });
});

async function fetchEmails() {
  try {
    const response = await fetch(
      "https://script.google.com/macros/s/AKfycbyGGp5ipXB19leYeKddnHwDOUf0VCQ2Sj8iOjpU0DvLkzcxIows39cvnp7Puqi9cHY/exec" // Replace with your Google Apps Script URL
    );
    const data = await response.json();
    return data.emails;
  } catch (error) {
    console.error("Error fetching emails:", error);
    return [];
  }
}
  </script>
</li>
